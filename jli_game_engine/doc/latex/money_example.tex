\hypertarget{money_example_Table}{}\section{of contents}\label{money_example_Table}

\begin{DoxyItemize}
\item \hyperlink{money_example_sec_setting_vc}{Setting up your project (V\+C++)}
\item \hyperlink{money_example_sec_setting_unix}{Setting up your project (Unix)}
\item \hyperlink{money_example_sec_running_test}{Running our tests}
\item \hyperlink{money_example_sec_adding_testfixture}{Adding the Test\+Fixture}
\item \hyperlink{money_example_sec_first_tests}{Our first tests}
\item \hyperlink{money_example_sec_more_tests}{Adding more tests}
\item \hyperlink{money_example_sec_credits}{Credits}
\end{DoxyItemize}

The example explored in this article can be found in {\ttfamily examples/\+Money/}.\hypertarget{money_example_sec_setting_vc}{}\section{Setting up your project (\+V\+C++)}\label{money_example_sec_setting_vc}
\hypertarget{money_example_sec_install}{}\subsection{Compiling and installing Cpp\+Unit libaries}\label{money_example_sec_install}
In the following document, \$\+C\+P\+P\+U\+N\+I\+T is the directory where you unpacked Cpp\+Unit\+: \$\+C\+P\+P\+U\+N\+I\+T/\+: include/ lib/ src/ cppunit/

First, you need to compile Cpp\+Unit libraries\+:
\begin{DoxyItemize}
\item Open the \$\+C\+P\+P\+U\+N\+I\+T/src/\+Cpp\+Unit\+Libraries.dsw workspace in V\+C++.
\item In the 'Build' menu, select 'Batch Build...'
\item In the batch build dialog, select all projects and press the build button.
\item The resulting libraries can be found in the \$\+C\+P\+P\+U\+N\+I\+T/lib/ directory.
\end{DoxyItemize}

Once it is done, you need to tell V\+C++ where are the includes and libraries to use them in other projects. Open the 'Tools/\+Options...' dialog, and in the 'Directories' tab, select 'include files' in the combo. Add a new entry that points to \$\+C\+P\+P\+U\+N\+I\+T/include/. Change to 'libraries files' in the combo and add a new entry for \$\+C\+P\+P\+U\+N\+I\+T/lib/. Repeat the process with 'source files' and add \$\+C\+P\+P\+U\+N\+I\+T/src/cppunit/.\hypertarget{money_example_sec_getting_started}{}\subsection{Getting started}\label{money_example_sec_getting_started}
Creates a new console application ('a simple application' template will do). Let's link Cpp\+Unit library to our project. In the project settings\+:
\begin{DoxyItemize}
\item In tab 'C++', combo 'Code generation', set the combo to 'Multithreaded D\+L\+L' for the release configuration, and 'Debug Multithreaded D\+L\+L' for the debug configure,
\item In tab 'C++', combo 'C++ langage', for All Configurations, check 'enable Run-\/\+Time \hyperlink{struct_type}{Type} Information (R\+T\+T\+I)',
\item In tab 'Link', in the 'Object/library modules' field, add cppunitd.\+lib for the debug configuration, and cppunit.\+lib for the release configuration.
\end{DoxyItemize}

We're done !\hypertarget{money_example_sec_setting_unix}{}\section{Setting up your project (\+Unix)}\label{money_example_sec_setting_unix}
We'll use {\ttfamily autoconf} and {\ttfamily automake} to make it simple to create our build environment. Create a directory somewhere to hold the code we're going to build. Create {\ttfamily configure.\+in} and {\ttfamily Makefile.\+am} in that directory to get started.

{\ttfamily configure.\+in} \begin{DoxyVerb}dnl Process this file with autoconf to produce a configure script.
AC_INIT(Makefile.am)
AM_INIT_AUTOMAKE(money,0.1)
AM_PATH_CPPUNIT(1.9.6)
AC_PROG_CXX
AC_PROG_CC
AC_PROG_INSTALL
AC_OUTPUT(Makefile)\end{DoxyVerb}


{\ttfamily Makefile.\+am} \begin{DoxyVerb}# Rules for the test code (use `make check` to execute)
TESTS = MoneyApp
check_PROGRAMS = $(TESTS)
MoneyApp_SOURCES = Money.h MoneyTest.h MoneyTest.cpp MoneyApp.cpp
MoneyApp_CXXFLAGS = $(CPPUNIT_CFLAGS)
MoneyApp_LDFLAGS = $(CPPUNIT_LIBS) -ldl\end{DoxyVerb}
\hypertarget{money_example_sec_running_test}{}\section{Running our tests}\label{money_example_sec_running_test}
We have a main that doesn't do anything. Let's start by adding the mechanics to run our tests (remember, test before you code ;-\/) ). For this example, we will use a \hyperlink{class_text_test_runner}{Text\+Test\+Runner} with the \hyperlink{class_compiler_outputter}{Compiler\+Outputter} for post-\/build testing\+:

{\ttfamily Money\+App.\+cpp} 
\begin{DoxyCode}
\textcolor{preprocessor}{#include "stdafx.h"}
\textcolor{preprocessor}{#include <cppunit/CompilerOutputter.h>}
\textcolor{preprocessor}{#include <cppunit/extensions/TestFactoryRegistry.h>}
\textcolor{preprocessor}{#include <cppunit/ui/text/TestRunner.h>}


\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])
\{
  \textcolor{comment}{// Get the top level suite from the registry}
  CppUnit::Test *suite = CppUnit::TestFactoryRegistry::getRegistry().makeTest();

  \textcolor{comment}{// Adds the test to the list of test to run}
  CppUnit::TextUi::TestRunner runner;
  runner.addTest( suite );

  \textcolor{comment}{// Change the default outputter to a compiler error format outputter}
  runner.setOutputter( \textcolor{keyword}{new} CppUnit::CompilerOutputter( &runner.result(),
                                                       std::cerr ) );
  \textcolor{comment}{// Run the tests.}
  \textcolor{keywordtype}{bool} wasSucessful = runner.run();

  \textcolor{comment}{// Return error code 1 if the one of test failed.}
  \textcolor{keywordflow}{return} wasSucessful ? 0 : 1;
\}
\end{DoxyCode}


V\+C++\+: Compile and run (Ctrl+\+F5).

Unix\+: First build. Since we don't have all the file yet, let's create them and build our application for the first time\+: \begin{DoxyVerb}touch Money.h MoneyTest.h MoneyTest.cpp
aclocal -I /usr/local/share/aclocal
autoconf
automake -a
touch NEWS README AUTHORS ChangeLog # To make automake happy
./configure
make check\end{DoxyVerb}


Our application will report that everything is fine and no test were run. So let's add some tests...\hypertarget{money_example_sec_post_build}{}\subsection{Setting up automated post-\/build testing (\+V\+C++)}\label{money_example_sec_post_build}
What does post-\/build testing means? It means that each time you compile, the test are automatically run when the build finish. This is very useful, if you compile often you can know that you just 'broke' something, or that everything is still working fine.

Let's adds that to our project, In the project settings, in the 'post-\/build step' tab\+:
\begin{DoxyItemize}
\item \hyperlink{struct_select}{Select} 'All configurations' (upper left combo)
\item In the 'Post-\/build description', enter 'Unit testing...'
\item In 'post-\/build command(s)', add a new line\+: {\ttfamily \$(Target\+Path)}
\end{DoxyItemize}

{\ttfamily \$(Target\+Path)} expands into the name of your application\+: Debug\textbackslash{}Money\+App.\+exe in debug configuration and Release\textbackslash{}Money\+App.\+exe in release configuration.

What we are doing is say to V\+C++ to run our application for each build. Notices the last line of {\ttfamily main()}, it returns a different error code, depending on weither or not a test failed. If the code returned by an application is not 0 in post-\/build step, it tell V\+C++ that the build step failed.

Compile. Notice that the application's output is now in the build window. How convenient!

(Unix\+: tips to integrate make check into various I\+D\+E?)\hypertarget{money_example_sec_adding_testfixture}{}\section{Adding the Test\+Fixture}\label{money_example_sec_adding_testfixture}
For this example, we are going to write a simple money class. Money has an amount and a currency. Let's begin by creating a fixture where we can put our tests, and add single test to test Money constructor\+:

{\ttfamily Money\+Test.\+h\+:} 
\begin{DoxyCode}
\textcolor{preprocessor}{#ifndef MONEYTEST\_H}
\textcolor{preprocessor}{#define MONEYTEST\_H}

\textcolor{preprocessor}{#include <cppunit/extensions/HelperMacros.h>}

\textcolor{keyword}{class }MoneyTest : \textcolor{keyword}{public} CppUnit::TestFixture
\{
  \hyperlink{group___writing_test_fixture_gabe1e12200f40d6f25d60c1783c99da81}{CPPUNIT\_TEST\_SUITE}( MoneyTest );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testConstructor );
  \hyperlink{group___writing_test_fixture_ga601b2e1d525f3947b216e28c625abcb1}{CPPUNIT\_TEST\_SUITE\_END}();

\textcolor{keyword}{public}:
  \textcolor{keywordtype}{void} setUp();
  \textcolor{keywordtype}{void} tearDown();

  \textcolor{keywordtype}{void} testConstructor();
\};

\textcolor{preprocessor}{#endif  // MONEYTEST\_H}
\end{DoxyCode}



\begin{DoxyItemize}
\item C\+P\+P\+U\+N\+I\+T\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E declares that our Fixture's test suite.
\item C\+P\+P\+U\+N\+I\+T\+\_\+\+T\+E\+S\+T adds a test to our test suite. The test is implemented by a method named test\+Constructor().
\item set\+Up() and tear\+Down() are use to set\+Up/tear\+Down some fixtures. We are not using any for now.
\end{DoxyItemize}

{\ttfamily Money\+Test.\+cpp} 
\begin{DoxyCode}
\textcolor{preprocessor}{#include "stdafx.h"}
\textcolor{preprocessor}{#include "MoneyTest.h"}

\textcolor{comment}{// Registers the fixture into the 'registry'}
\hyperlink{group___creating_test_suite_ga2f4071eec88d1e306665ada0f2dd80e4}{CPPUNIT\_TEST\_SUITE\_REGISTRATION}( MoneyTest );


\textcolor{keywordtype}{void} 
MoneyTest::setUp()
\{
\}


\textcolor{keywordtype}{void} 
MoneyTest::tearDown()
\{
\}


\textcolor{keywordtype}{void} 
MoneyTest::testConstructor()
\{
  \hyperlink{group___assertions_ga26aaaa22505b7a7b4978f0401a86f12a}{CPPUNIT\_FAIL}( \textcolor{stringliteral}{"not implemented"} );
\}
\end{DoxyCode}


Compile. As expected, it reports that a test failed. Press the {\ttfamily F4} key (Go to next Error). V\+C++ jump right to our failed assertion C\+P\+P\+U\+N\+I\+T\+\_\+\+F\+A\+I\+L. We can not ask better in term of integration! \begin{DoxyVerb}Compiling...
MoneyTest.cpp
Linking...
Unit testing...
.F
G:\prg\vc\Lib\cppunit\examples\money\MoneyTest.cpp(26):Assertion
Test name: MoneyTest.testConstructor
not implemented
Failures !!!
Run: 1   Failure total: 1   Failures: 1   Errors: 0
Error executing d:\winnt\system32\cmd.exe.

moneyappd.exe - 1 error(s), 0 warning(s)
\end{DoxyVerb}


Well, we have everything set up, let's start doing some real testing.\hypertarget{money_example_sec_first_tests}{}\section{Our first tests}\label{money_example_sec_first_tests}
Let's write our first real test. A test is usually decomposed in three parts\+:
\begin{DoxyItemize}
\item setting up datas used by the test
\item doing some processing based on those datas
\item checking the result of the processing
\end{DoxyItemize}


\begin{DoxyCode}
\textcolor{keywordtype}{void} 
MoneyTest::testConstructor()
\{
  \textcolor{comment}{// Set up}
  \textcolor{keyword}{const} std::string currencyFF( \textcolor{stringliteral}{"FF"} );
  \textcolor{keyword}{const} \textcolor{keywordtype}{double} longNumber = 12345678.90123;

  \textcolor{comment}{// Process}
  Money money( longNumber, currencyFF );

  \textcolor{comment}{// Check}
  \hyperlink{group___assertions_ga71162f05be07ef6817d156e77c68b1a3}{CPPUNIT\_ASSERT\_EQUAL}( longNumber, money.getAmount() );
  \hyperlink{group___assertions_ga71162f05be07ef6817d156e77c68b1a3}{CPPUNIT\_ASSERT\_EQUAL}( currencyFF, money.getCurrency() );
\}
\end{DoxyCode}


Well, we finally have a good start of what our Money class will look like. Let's start implementing...

{\ttfamily Money.\+h} 
\begin{DoxyCode}
\textcolor{preprocessor}{#ifndef MONEY\_H}
\textcolor{preprocessor}{#define MONEY\_H}

\textcolor{preprocessor}{#include <string>}

\textcolor{keyword}{class }Money
\{
\textcolor{keyword}{public}:
  Money( \textcolor{keywordtype}{double} amount, std::string currency )
    : m\_amount( amount )
    , m\_currency( currency )
  \{
  \}

  \textcolor{keywordtype}{double} getAmount()\textcolor{keyword}{ const}
\textcolor{keyword}{  }\{
    \textcolor{keywordflow}{return} m\_amount;
  \}

  std::string getCurrency()\textcolor{keyword}{ const}
\textcolor{keyword}{  }\{
    \textcolor{keywordflow}{return} m\_currency;
  \}

\textcolor{keyword}{private}:
  \textcolor{keywordtype}{double} m\_amount;
  std::string m\_currency;
\};

\textcolor{preprocessor}{#endif}
\end{DoxyCode}


Include {\ttfamily Money.\+h} in Money\+Test.\+cpp and compile.

Hum, an assertion failed! Press F4, and we jump to the assertion that checks the currency of the constructed money object. The report indicates that string is not equal to expected value. There is only two ways for this to happen\+: the member was badly initialized or we returned the wrong value. After a quick check, we find out it is the former. Let's fix that\+:

{\ttfamily Money.\+h} 
\begin{DoxyCode}
Money( \textcolor{keywordtype}{double} amount, std::string currency )
  : m\_amount( amount )
  , m\_currency( currency )
\{
\}
\end{DoxyCode}


Compile. Our test finally pass! Let's add some functionnality to our Money class.\hypertarget{money_example_sec_more_tests}{}\section{Adding more tests}\label{money_example_sec_more_tests}
\hypertarget{money_example_sec_equal}{}\subsection{Testing for equality}\label{money_example_sec_equal}
We want to check if to Money object are equal. Let's start by adding a new test to the suite, then add our method\+:

{\ttfamily Money\+Test.\+h} 
\begin{DoxyCode}
  \hyperlink{group___writing_test_fixture_gabe1e12200f40d6f25d60c1783c99da81}{CPPUNIT\_TEST\_SUITE}( MoneyTest );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testConstructor );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testEqual );
  \hyperlink{group___writing_test_fixture_ga601b2e1d525f3947b216e28c625abcb1}{CPPUNIT\_TEST\_SUITE\_END}();
\textcolor{keyword}{public}:
  ...
  \textcolor{keywordtype}{void} testEqual();
\end{DoxyCode}


{\ttfamily Money\+Test.\+cpp} 
\begin{DoxyCode}
\textcolor{keywordtype}{void}
MoneyTest::testEqual()
\{
  \textcolor{comment}{// Set up}
  \textcolor{keyword}{const} Money money123FF( 123, \textcolor{stringliteral}{"FF"} );
  \textcolor{keyword}{const} Money money123USD( 123, \textcolor{stringliteral}{"USD"} );
  \textcolor{keyword}{const} Money money12FF( 12, \textcolor{stringliteral}{"FF"} );
  \textcolor{keyword}{const} Money money12USD( 12, \textcolor{stringliteral}{"USD"} );

  \textcolor{comment}{// Process & Check}
  CPPUNIT\_ASSERT( money123FF == money123FF );     \textcolor{comment}{// ==}
  CPPUNIT\_ASSERT( money12FF != money123FF );      \textcolor{comment}{// != amount}
  CPPUNIT\_ASSERT( money123USD != money123FF );    \textcolor{comment}{// != currency}
  CPPUNIT\_ASSERT( money12USD != money123FF );     \textcolor{comment}{// != currency and != amount}
\}
\end{DoxyCode}


Let's implements {\ttfamily operator} {\ttfamily ==} and {\ttfamily operator} {\ttfamily !=} in Money.\+h\+:

{\ttfamily Money.\+h} 
\begin{DoxyCode}
\textcolor{keyword}{class }Money
\{
\textcolor{keyword}{public}:
...
  \textcolor{keywordtype}{bool} \hyperlink{group___a_p_i___o_g_l_e_s2_ga8425a5ca2f4117542f2cb1c12ded2236}{operator ==}( \textcolor{keyword}{const} Money &other )\textcolor{keyword}{ const}
\textcolor{keyword}{  }\{
    \textcolor{keywordflow}{return} m\_amount == other.m\_amount  &&  
           m\_currency == other.m\_currency;
  \}

  \textcolor{keywordtype}{bool} operator !=( \textcolor{keyword}{const} Money &other )\textcolor{keyword}{ const}
\textcolor{keyword}{  }\{
    \textcolor{keywordflow}{return} (*\textcolor{keyword}{this} == other);
  \}
\};
\end{DoxyCode}


Compile, run... Ooops... Press F4, it seems we're having trouble with {\ttfamily operator} {\ttfamily !=}. Let's fix that\+: 
\begin{DoxyCode}
\textcolor{keywordtype}{bool} operator !=( \textcolor{keyword}{const} Money &other )\textcolor{keyword}{ const}
\textcolor{keyword}{}\{
  \textcolor{keywordflow}{return} !(*\textcolor{keyword}{this} == other);
\}
\end{DoxyCode}


Compile, run. Finally got it working!\hypertarget{money_example_sec_opadd}{}\subsection{Adding moneys}\label{money_example_sec_opadd}
Let's add our test 'test\+Add' to Money\+Test. You know the routine...

{\ttfamily Money\+Test.\+cpp} 
\begin{DoxyCode}
\textcolor{keywordtype}{void} 
MoneyTest::testAdd()
\{
  \textcolor{comment}{// Set up}
  \textcolor{keyword}{const} Money money12FF( 12, \textcolor{stringliteral}{"FF"} );
  \textcolor{keyword}{const} Money expectedMoney( 135, \textcolor{stringliteral}{"FF"} );

  \textcolor{comment}{// Process}
  Money money( 123, \textcolor{stringliteral}{"FF"} );
  money += money12FF;

  \textcolor{comment}{// Check}
  CPPUNIT\_ASSERT( expectedMoney == money );           \textcolor{comment}{// add works}
  CPPUNIT\_ASSERT( &money == &(money += money12FF) );  \textcolor{comment}{// add returns ref. on 'this'.}
\}
\end{DoxyCode}


While writing that test case, you ask yourself, what is the result of adding money of currencies. Obviously this is an error and it should be reported, say let throw an exception, say {\ttfamily Incompatible\+Money\+Error}, when the currencies are not equal. We will write another test case for this later. For now let get our test\+Add() case working\+:

{\ttfamily Money.\+h} 
\begin{DoxyCode}
\textcolor{keyword}{class }Money
\{
\textcolor{keyword}{public}:
...
  Money &operator +=( \textcolor{keyword}{const} Money &other )
  \{
    m\_amount += other.m\_amount;
    \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
  \}
\}; 
\end{DoxyCode}


Compile, run. Miracle, everything is fine! Just to be sure the test is indeed working, in the above code, change {\ttfamily m\+\_\+amount} {\ttfamily +=} to {\ttfamily -\/=}. Build and check that it fails (always be suspicious of test that work the first time\+: you may have forgotten to add it to the suite for example)! Change the code back so that all the tests are working.

Let's the incompatible money test case before we forget about it... That test case expect an {\ttfamily Incompatible\+Money\+Error} exception to be thrown. Cpp\+Unit can test that for us, you need to specify that the test case expect an exception when you add it to the suite\+:

{\ttfamily Money\+Test.\+h} 
\begin{DoxyCode}
\textcolor{keyword}{class }MoneyTest : \textcolor{keyword}{public} CppUnit::TestFixture
\{
  \hyperlink{group___writing_test_fixture_gabe1e12200f40d6f25d60c1783c99da81}{CPPUNIT\_TEST\_SUITE}( MoneyTest );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testConstructor );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testEqual );
  \hyperlink{group___writing_test_fixture_gaac9b03d898b207e1daf2f93867935a96}{CPPUNIT\_TEST}( testAdd );
  \hyperlink{group___writing_test_fixture_gaca8eeb6f60714baade6cbfd185868c40}{CPPUNIT\_TEST\_EXCEPTION}( testAddThrow, IncompatibleMoneyError );
  \hyperlink{group___writing_test_fixture_ga601b2e1d525f3947b216e28c625abcb1}{CPPUNIT\_TEST\_SUITE\_END}();
\textcolor{keyword}{public}:
  ...
  \textcolor{keywordtype}{void} testAddThrow();
\};
\end{DoxyCode}


By convention, you end the name of such tests with {\ttfamily 'Throw'}, that way, you know that the test expect an exception to be thrown. Let's write our test case\+:

{\ttfamily Money\+Test.\+cpp} 
\begin{DoxyCode}
\textcolor{keywordtype}{void} 
MoneyTest::testAddThrow()
\{
  \textcolor{comment}{// Set up}
  \textcolor{keyword}{const} Money money123FF( 123, \textcolor{stringliteral}{"FF"} );

  \textcolor{comment}{// Process}
  Money money( 123, \textcolor{stringliteral}{"USD"} );
  money += money123FF;        \textcolor{comment}{// should throw an exception}
\}
\end{DoxyCode}


Compile... Ooops, forgot to declare the exception class. Let's do that\+:

{\ttfamily Money.\+h} 
\begin{DoxyCode}
\textcolor{preprocessor}{#include <string>}
\textcolor{preprocessor}{#include <stdexcept>}

\textcolor{keyword}{class }IncompatibleMoneyError : \textcolor{keyword}{public} std::runtime\_error
\{
\textcolor{keyword}{public}:
  IncompatibleMoneyError() : runtime\_error( \textcolor{stringliteral}{"Incompatible moneys"} )
  \{
  \}
\};
\end{DoxyCode}


Compile. As expected test\+Add\+Throw() fail... Let's fix that\+:

{\ttfamily Money.\+h} 
\begin{DoxyCode}
Money &operator +=( \textcolor{keyword}{const} Money &other )
\{
  \textcolor{keywordflow}{if} ( m\_currency != other.m\_currency )
    \textcolor{keywordflow}{throw} IncompatibleMoneyError();

  m\_amount += other.m\_amount;
  \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
\}
\end{DoxyCode}


Compile. Our test finaly passes!

T\+O\+D\+O\+:
\begin{DoxyItemize}
\item How to use C\+P\+P\+U\+N\+I\+T\+\_\+\+A\+S\+S\+E\+R\+T\+\_\+\+E\+Q\+U\+A\+L\+S with Money
\item Copy constructor/\+Assignment operator
\item Introducing fixtures
\item ?
\end{DoxyItemize}\hypertarget{money_example_sec_credits}{}\section{Credits}\label{money_example_sec_credits}
This article was written by Baptiste Lepilleur. Unix configuration \& set up by Phil Verghese. Inspired from many others (J\+Unit, Phil's cookbook...), and all the newbies around that keep asking me for the 'Hello world' example ;-\/) 
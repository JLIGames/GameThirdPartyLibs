\hypertarget{group__encfuncs}{\section{Functions for Encoding}
\label{group__encfuncs}\index{Functions for Encoding@{Functions for Encoding}}
}
\subsection*{Functions for encoding}
\label{_amgrpc58fb8743a7ca83eb895d57e29e032c8}%
You must link to {\ttfamily libtheoraenc} and {\ttfamily libtheoradec} if you use any of the functions in this section.

The functions are listed in the order they are used in a typical encode. The basic steps are\+:
\begin{DoxyItemize}
\item Fill in a \hyperlink{structth__info}{th\+\_\+info} structure with details on the format of the video you wish to encode.
\item Allocate a \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle with \hyperlink{group__encfuncs_gaa91e47bc9dd5f6ee52045bd7b815e5a7}{th\+\_\+encode\+\_\+alloc()}.
\item Perform any additional encoder configuration required with \hyperlink{group__encfuncs_ga3a427f6514dfdc01ea72172c469d51d9}{th\+\_\+encode\+\_\+ctl()}.
\item Repeatedly call \hyperlink{group__encfuncs_ga9439d61b566039d194ff782681fbc408}{th\+\_\+encode\+\_\+flushheader()} to retrieve all the header packets.
\item For each uncompressed frame\+:
\begin{DoxyItemize}
\item Submit the uncompressed frame via \hyperlink{group__encfuncs_gadbe7dd66b411c2d61ab8153c15308750}{th\+\_\+encode\+\_\+ycbcr\+\_\+in()}
\item Repeatedly call \hyperlink{group__encfuncs_ga96d8ac1dda53187455352f99bbb5b04b}{th\+\_\+encode\+\_\+packetout()} to retrieve any video data packets that are ready.
\end{DoxyItemize}
\item Call \hyperlink{group__encfuncs_ga36b23d216532231925c4107894204680}{th\+\_\+encode\+\_\+free()} to release all encoder memory. 
\end{DoxyItemize}\begin{DoxyCompactItemize}
\item 
\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$ \hyperlink{group__encfuncs_gaa91e47bc9dd5f6ee52045bd7b815e5a7}{th\+\_\+encode\+\_\+alloc} (const \hyperlink{structth__info}{th\+\_\+info} $\ast$\+\_\+info)
\item 
int \hyperlink{group__encfuncs_ga3a427f6514dfdc01ea72172c469d51d9}{th\+\_\+encode\+\_\+ctl} (\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$\+\_\+enc, int \+\_\+req, void $\ast$\+\_\+buf, size\+\_\+t \+\_\+buf\+\_\+sz)
\item 
int \hyperlink{group__encfuncs_ga9439d61b566039d194ff782681fbc408}{th\+\_\+encode\+\_\+flushheader} (\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$\+\_\+enc, \hyperlink{structth__comment}{th\+\_\+comment} $\ast$\+\_\+comments, \hyperlink{structogg__packet}{ogg\+\_\+packet} $\ast$\+\_\+op)
\item 
int \hyperlink{group__encfuncs_gadbe7dd66b411c2d61ab8153c15308750}{th\+\_\+encode\+\_\+ycbcr\+\_\+in} (\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$\+\_\+enc, \hyperlink{theora_2libtheora-1_81_81_2include_2theora_2codec_8h_a343f7cfabad179cc4fe527cf06873f45}{th\+\_\+ycbcr\+\_\+buffer} \+\_\+ycbcr)
\item 
int \hyperlink{group__encfuncs_ga96d8ac1dda53187455352f99bbb5b04b}{th\+\_\+encode\+\_\+packetout} (\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$\+\_\+enc, int \+\_\+last, \hyperlink{structogg__packet}{ogg\+\_\+packet} $\ast$\+\_\+op)
\item 
void \hyperlink{group__encfuncs_ga36b23d216532231925c4107894204680}{th\+\_\+encode\+\_\+free} (\hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} $\ast$\+\_\+enc)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


\subsection{Function Documentation}
\hypertarget{group__encfuncs_gaa91e47bc9dd5f6ee52045bd7b815e5a7}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+alloc@{th\+\_\+encode\+\_\+alloc}}
\index{th\+\_\+encode\+\_\+alloc@{th\+\_\+encode\+\_\+alloc}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+alloc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf th\+\_\+enc\+\_\+ctx}$\ast$ th\+\_\+encode\+\_\+alloc (
\begin{DoxyParamCaption}
\item[{const {\bf th\+\_\+info} $\ast$}]{\+\_\+info}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_gaa91e47bc9dd5f6ee52045bd7b815e5a7}
Allocates an encoder instance. 
\begin{DoxyParams}{Parameters}
{\em \+\_\+info} & A \hyperlink{structth__info}{th\+\_\+info} struct filled with the desired encoding parameters. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The initialized \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em N\+U\+L\+L} & If the encoding parameters were invalid. \\
\hline
\end{DoxyRetVals}


Here is the caller graph for this function\+:


\hypertarget{group__encfuncs_ga3a427f6514dfdc01ea72172c469d51d9}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+ctl@{th\+\_\+encode\+\_\+ctl}}
\index{th\+\_\+encode\+\_\+ctl@{th\+\_\+encode\+\_\+ctl}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+ctl}]{\setlength{\rightskip}{0pt plus 5cm}int th\+\_\+encode\+\_\+ctl (
\begin{DoxyParamCaption}
\item[{{\bf th\+\_\+enc\+\_\+ctx} $\ast$}]{\+\_\+enc, }
\item[{int}]{\+\_\+req, }
\item[{void $\ast$}]{\+\_\+buf, }
\item[{size\+\_\+t}]{\+\_\+buf\+\_\+sz}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_ga3a427f6514dfdc01ea72172c469d51d9}
Encoder control function. This is used to provide advanced control the encoding process. 
\begin{DoxyParams}{Parameters}
{\em \+\_\+enc} & A \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. \\
\hline
{\em \+\_\+req} & The control code to process. See \hyperlink{vorbisenc_8h_encctlcodes}{the list of available control codes} for details. \\
\hline
{\em \+\_\+buf} & The parameters for this control code. \\
\hline
{\em \+\_\+buf\+\_\+sz} & The size of the parameter buffer. \\
\hline
\end{DoxyParams}


Here is the caller graph for this function\+:


\hypertarget{group__encfuncs_ga9439d61b566039d194ff782681fbc408}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+flushheader@{th\+\_\+encode\+\_\+flushheader}}
\index{th\+\_\+encode\+\_\+flushheader@{th\+\_\+encode\+\_\+flushheader}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+flushheader}]{\setlength{\rightskip}{0pt plus 5cm}int th\+\_\+encode\+\_\+flushheader (
\begin{DoxyParamCaption}
\item[{{\bf th\+\_\+enc\+\_\+ctx} $\ast$}]{\+\_\+enc, }
\item[{{\bf th\+\_\+comment} $\ast$}]{\+\_\+comments, }
\item[{{\bf ogg\+\_\+packet} $\ast$}]{\+\_\+op}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_ga9439d61b566039d194ff782681fbc408}
Outputs the next header packet. This should be called repeatedly after encoder initialization until it returns 0 in order to get all of the header packets, in order, before encoding actual video data. 
\begin{DoxyParams}{Parameters}
{\em \+\_\+enc} & A \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. \\
\hline
{\em \+\_\+comments} & The metadata to place in the comment header, when it is encoded. \\
\hline
{\em \+\_\+op} & An {\ttfamily \hyperlink{structogg__packet}{ogg\+\_\+packet}} structure to fill. All of the elements of this structure will be set, including a pointer to the header data. The memory for the header data is owned by {\ttfamily libtheoraenc}, and may be invalidated when the next encoder function is called. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A positive value indicates that a header packet was successfully produced. 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em 0} & No packet was produced, and no more header packets remain. \\
\hline
{\em T\+H\+\_\+\+E\+F\+A\+U\+L\+T} & {\itshape \+\_\+enc}, {\itshape \+\_\+comments}, or {\itshape \+\_\+op} was {\ttfamily N\+U\+L\+L}. \\
\hline
\end{DoxyRetVals}


Here is the call graph for this function\+:




Here is the caller graph for this function\+:


\hypertarget{group__encfuncs_ga36b23d216532231925c4107894204680}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+free@{th\+\_\+encode\+\_\+free}}
\index{th\+\_\+encode\+\_\+free@{th\+\_\+encode\+\_\+free}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+free}]{\setlength{\rightskip}{0pt plus 5cm}void th\+\_\+encode\+\_\+free (
\begin{DoxyParamCaption}
\item[{{\bf th\+\_\+enc\+\_\+ctx} $\ast$}]{\+\_\+enc}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_ga36b23d216532231925c4107894204680}
Frees an allocated encoder instance. 
\begin{DoxyParams}{Parameters}
{\em \+\_\+enc} & A \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. \\
\hline
\end{DoxyParams}
\hypertarget{group__encfuncs_ga96d8ac1dda53187455352f99bbb5b04b}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+packetout@{th\+\_\+encode\+\_\+packetout}}
\index{th\+\_\+encode\+\_\+packetout@{th\+\_\+encode\+\_\+packetout}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+packetout}]{\setlength{\rightskip}{0pt plus 5cm}int th\+\_\+encode\+\_\+packetout (
\begin{DoxyParamCaption}
\item[{{\bf th\+\_\+enc\+\_\+ctx} $\ast$}]{\+\_\+enc, }
\item[{int}]{\+\_\+last, }
\item[{{\bf ogg\+\_\+packet} $\ast$}]{\+\_\+op}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_ga96d8ac1dda53187455352f99bbb5b04b}
Retrieves encoded video data packets. This should be called repeatedly after each frame is submitted to flush any encoded packets, until it returns 0. The encoder will not buffer these packets as subsequent frames are compressed, so a failure to do so will result in lost video data. \begin{DoxyNote}{Note}
Currently the encoder operates in a one-\/frame-\/in, one-\/packet-\/out manner. However, this may be changed in the future. 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em \+\_\+enc} & A \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. \\
\hline
{\em \+\_\+last} & Set this flag to a non-\/zero value if no more uncompressed frames will be submitted. This ensures that a proper E\+O\+S flag is set on the last packet. \\
\hline
{\em \+\_\+op} & An {\ttfamily \hyperlink{structogg__packet}{ogg\+\_\+packet}} structure to fill. All of the elements of this structure will be set, including a pointer to the video data. The memory for the video data is owned by {\ttfamily libtheoraenc}, and may be invalidated when the next encoder function is called. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A positive value indicates that a video data packet was successfully produced. 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em 0} & No packet was produced, and no more encoded video data remains. \\
\hline
{\em T\+H\+\_\+\+E\+F\+A\+U\+L\+T} & {\itshape \+\_\+enc} or {\itshape \+\_\+op} was {\ttfamily N\+U\+L\+L}. \\
\hline
\end{DoxyRetVals}


Here is the call graph for this function\+:




Here is the caller graph for this function\+:


\hypertarget{group__encfuncs_gadbe7dd66b411c2d61ab8153c15308750}{\index{Functions for Encoding@{Functions for Encoding}!th\+\_\+encode\+\_\+ycbcr\+\_\+in@{th\+\_\+encode\+\_\+ycbcr\+\_\+in}}
\index{th\+\_\+encode\+\_\+ycbcr\+\_\+in@{th\+\_\+encode\+\_\+ycbcr\+\_\+in}!Functions for Encoding@{Functions for Encoding}}
\subsubsection[{th\+\_\+encode\+\_\+ycbcr\+\_\+in}]{\setlength{\rightskip}{0pt plus 5cm}int th\+\_\+encode\+\_\+ycbcr\+\_\+in (
\begin{DoxyParamCaption}
\item[{{\bf th\+\_\+enc\+\_\+ctx} $\ast$}]{\+\_\+enc, }
\item[{{\bf th\+\_\+ycbcr\+\_\+buffer}}]{\+\_\+ycbcr}
\end{DoxyParamCaption}
)}}\label{group__encfuncs_gadbe7dd66b411c2d61ab8153c15308750}
Submits an uncompressed frame to the encoder. 
\begin{DoxyParams}{Parameters}
{\em \+\_\+enc} & A \hyperlink{structth__enc__ctx}{th\+\_\+enc\+\_\+ctx} handle. \\
\hline
{\em \+\_\+ycbcr} & A buffer of Y'Cb\+Cr data to encode. \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Success. \\
\hline
{\em T\+H\+\_\+\+E\+F\+A\+U\+L\+T} & {\itshape \+\_\+enc} or {\itshape \+\_\+ycbcr} is {\ttfamily N\+U\+L\+L}. \\
\hline
{\em T\+H\+\_\+\+E\+I\+N\+V\+A\+L} & The buffer size does not match the frame size the encoder was initialized with, or encoding has already completed. \\
\hline
\end{DoxyRetVals}


Here is the caller graph for this function\+:


